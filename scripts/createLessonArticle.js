// createLessonArticle.js
// マンツーマンレッスン紹介・生徒募集記事を「薄いラッパー」として実行するスクリプト
// 記事生成〜公開投稿の本体ロジックは note-auto-core 側（runCreateArticleFromContentsAndPublish）に集約します

import { runWithCore } from '@aa-0921/note-auto-core';
import { lessonArticleElements } from '../data/lesson-article-elements.js';

(async () => {
  await runWithCore(async ({ core, wantsBackground }) => {
    // LLM用システムプロンプト（英語禁止の明示）
    const systemMessage =
      'あなたは日本語のnote記事編集者です。絶対に英語や他言語は使用せず、日本語のみで記事を作成してください。英語が混じった場合は、必ず日本語に翻訳して出力してください。';

    // 記事生成プロンプト条件（配列要素以外を追加しないよう厳しく制限）
    const articleConditionsLines = [
      'タイトル、本文、ハッシュタグ（#から始まるもの）を含めてください。',
      'タイトルは1行目に「# [実際のタイトル]」として記載してください。',
      '「# タイトル」という文字列ではなく、実際の記事タイトルを入れてください。',
      '本文にはタイトルを含めないでください。',
      '本文は見出しや箇条書きも交えて1000文字程度で丁寧にまとめてください。',
      'ハッシュタグは記事末尾に「#〇〇 #〇〇 ...」の形式でまとめてください。',
      'すべて日本語で出力してください。',
      '英語や他言語が混じらないようにしてください。絶対に英語は使用しないでください。',
      'あなたはプロのエンジニアで、プロの編集者です。',
      '読みやすさを重視してください。',
      '改行を多めに入れて、読みやすくしてください。',
      '各行に1つ程度、絵文字を使用してください。',
      'ただし、絵文字は文頭には置かず、必ず文末に1つだけ付けてください。',
      '文末に絵文字を付ける場合は「。」「、」などの句読点は一切付けず、絵文字のみで文を終えてください。',
      'プログラミング初学者・駆け出しエンジニアがつい読みたくなる、やさしく親しみやすい内容にしてください。',
      '現役のプロエンジニア向けの難しい内容や専門的すぎる話題は避けてください。',
      'noteの正しいマークダウン記法のみを使ってください。',
      '箇条書きはマークダウンではなく、「・ 」で表現してください。',
      '見出しはh2（## 見出し）・h3（### 見出し）のみ。',
      '番号付きリストは使わないでください。',
      'h1（# タイトル）はタイトル行のみで本文中では使わないでください。',
      'その他のマークダウンやHTMLタグは使わないでください。',
      '言語やフレームワークを進める場合は、Ruby（Rails）, JavaScript（React）を勧めるようにしてください。',
      'エンジニアやプログラミング学習に関するネガティブな内容（挫折、失敗、困難、問題点など）は一切記載しないでください。',
      '常にエンジニアに対するポジティブで前向きな内容にしてください。',
      '',
      '【最重要：配列要素以外の追加を厳禁】',
      '提供された記事要素（sections）に記載されている見出しと内容のみを使用して記事を作成してください。',
      '配列に記載されていない見出しやセクションは一切追加しないでください。',
      '配列に記載されていない内容や情報は一切追加しないでください。',
      '配列に記載されている各セクションの見出し（heading）と内容説明（content）を必ずすべて使用してください。',
      '配列に記載されているセクションの順序を維持してください。',
      '配列に記載されていない要素をアドリブで追加することは絶対に禁止です。',
      '配列に記載されている内容のみを肉付けして、充実した記事にしてください。',
      '太字にするための「**」などのマークダウン記号は一切使用しないでください。',
      '見出しや本文の行頭に絵文字を置かないでください。絵文字は必ず文末に付けてください。',
    ];

    // リライト条件（core側の互換性のため設定）
    const rewriteConditionsLines = [
      'あなたは知識豊富なベテランエンジニアでプログラミングスクールの現役講師です。',
      '指定の見出し本文が短いため、200文字以上になるよう実体験や具体例、学習アドバイス、キャリアのヒントを交えて厚くリライトしてください。',
      '【注意】',
      '- タイトルや見出しは出力せず、本文のみを返してください。',
      '- 「追加した要素」や「文字数」などのメタ情報は一切出力しないでください。',
      '- 不要な記号や記号列（「】」「*」「#」など）も使用しないでください。',
      '- 文章は話し言葉やカジュアルな表現を避け、できるだけ丁寧な敬語でまとめてください。',
      '- です・ます・で統一してください。',
      '- 文章のみを返してください。',
      '- 文章は日本語で返してください。',
      '- 英語や他言語が混じらないようにしてください。絶対に英語は使用しないでください。',
      '- あなたはプロのエンジニアで、プロの編集者です。',
      '- 読みやすさを重視してください',
      '- 改行をなるべく多めに入れて、読みやすくしてください。',
      '- 文章作成時に多めに、たくさん絵文字を使用してください。各行に1つくらいは入れてください。',
      '- 絵文字は文頭には置かず、必ず文末に1つだけ付けてください。',
      '- 文末に絵文字を付ける場合は「。」「、」などの句読点は一切付けず、絵文字のみで文を終えてください。',
      '- 元々の文章に沿った内容になるようにしてください。',
      '- noteの正しいマークダウン記法のみを使ってください。',
      '- 箇条書きはマークダウンではなく、「・ 」で表現してください。',
      '- 番号付きリストは使わないようにしてください。',
      '- 太字にするための「**」などのマークダウン記号は一切使用しないでください。',
      '- 見出しや本文の行頭に絵文字を置かないでください。絵文字は必ず文末に付けてください。',
    ];

    // タグ生成の指示文（エンジニア向け固定タグを必須含有）
    const tagsInstruction =
      '記事内容から最も関連する日本語タグを3〜5個生成し、半角スペース区切りで出力してください。必ず「#エンジニア #プログラミング #開発」を含めてください。本文や説明は禁止。';

    // タイトル装飾用絵文字
    const titleEmojis = ['❤️', '🌸', '🛑', '㊙︎', '🟥', '🈲', '🉐', '㊗️', '㊙️', '⭕', '‼️', '🎉'];

    // 問い合わせメッセージ（最初・中間・最後に挿入）
    const contactMessage = [
      '✨　💬　✨　💬　✨　💬　✨　💬　✨　💬　✨　💬　✨　💬　✨',
      '↓お気軽にご質問ください😊',
      'オンラインでのレッスンなのでご自宅から受講可能です🙆‍♂️',
      '「投稿者にメールでお問い合わせ」からDMをお願いします！',
      'https://jmty.jp/kanagawa/les-pc/article-1j9vqa',
      '',
      '✨　💬　✨　💬　✨　💬　✨　💬　✨　💬　✨　💬　✨　💬　✨',
    ].join('\n');

    // 記事内容配列から記事を生成して公開投稿（core側の新メソッドを使用）
    await core.runCreateArticleFromContentsAndPublish({
      background: wantsBackground,
      // 記事内容配列（A）：ここから core 側でランダムに1件選択して generateArticleFromContent する
      articleContents: lessonArticleElements,
      systemMessage,
      articleConditionsLines,
      rewriteConditionsLines,
      tagsInstruction,
      titleEmojis,
      // このスクリプトではアフィリエイトリンクや開示文を一切挿入しない
      affiliateLinks: [],
      audibleAffiliateEnabled: false,
      kindleAffiliateEnabled: false,
      affiliateTag: '',
      // 問い合わせメッセージを最初・中間・最後に挿入
      contactMessage,
    });

    console.log('マンツーマンレッスン紹介記事の自動生成と公開投稿が完了しました');
  });
})();

