// autoCreateAndDraftNote.js
// 薄いラッパー：既存のCLI引数・動作は維持しつつ、実装は共有ライブラリに委譲

import { runWithCore } from '@aa-0921/note-auto-core';

// アフィリエイト設定とリンクを別ファイルから読み込み
import { affiliateConfig, affiliateLinks } from './affiliateConfig.js';

// 再エクスポート（他のファイルから参照できるように）
export { affiliateConfig, affiliateLinks };

(async () => {
  await runWithCore(async ({ core, wantsBackground }) => {
    // アカウント固有の題材・切り口（ここで管理）
    // 旧topics（参考のためコメントアウト）
    // const topics = [
    //   'エンジニアのメリット',
    //   'プログラミング学習',
    //   'エンジニア転職のメリット',
    //   'エンジニア転職のメリット',
    //   'エンジニア転職のメリット',
    //   '未経験からのキャリアチェンジ',
    //   'フリーランスエンジニアのメリット',
    //   '初学者の悩み',
    //   '挫折しないための学習習慣',
    //   '未経験からのエンジニア転職',
    //   'リモートワークのメリット',
    //   'リモートワークで解決できること',
    //   'エンジニアのコスパがいい理由',
    //   '副業やフリーランスとしても働きやすい',
    //   '転職市場での需要が高い',
    //   '未経験からでも参入しやすい業界',
    //   '年齢よりスキルが評価されやすい',
    //   '世界中どこでも仕事ができる',
    //   '実力主義でキャリアアップしやすい',
    //   'スタートアップから大企業まで活躍の場所が多い',
    //   '職種・業界の選択肢が広い（自社開発、受託、メガベンチャーなど）',
    //   '海外で働きやすい（普遍的なスキル）',
    //   'スキルを身につければ収入アップしやすい',
    //   'プログラミング力がつく',
    //   '論理的思考が鍛えられる',
    //   '自分のサービスを作れるようになる',
    //   '新しいテクノロジーに触れ続けられる',
    //   '英語力が自然と身につくケースも多い（英語のドキュメントが多いため）',
    //   'ITリテラシーが高くなる',
    //   '自動化・効率化ができるようになる',
    //   'アイデアをすぐ形にできる実現力がつく',
    //   '場所や時間に縛られない生き方ができる',
    //   '趣味や好きな分野×技術で稼げる',
    //   '将来性がありAI時代にも強いスキル',
    //   '家族や友人のサイト・アプリなどを作ってあげられる',
    //   '自己表現の手段になる',
    //   '人生の選択肢が増える',
    //   '学生や若いうちからでも活躍しやすい',
    //   '永続的に学び続けられる楽しさがある',
    //   '将来的に起業・サービス開発に結びつけられる',
    //   'モノづくりの達成感が感じられる',
    //   '世界中の人々に価値提供ができる',
    //   '成果物が形として残る',
    //   '年収が高い傾向がある',
    //   'IT投資が続く限り市場が拡大し続けている',
    // ];
    // 新topics（エンジニアになるメリットを強調）
    const topics = [
      'エンジニアは収入アップが狙える',
      '在宅・リモートで自由に働ける',
      '実力主義で年齢に左右されにくい',
      'どこでも通用する汎用スキルが身につく',
      'グローバルに働けるチャンスが広がる',
      '副業・フリーランスで稼ぎやすい',
      '個人開発で収益源を作れる',
      '転職市場で常に需要が高い',
      '未経験からでもキャリアチェンジしやすい',
      '成果が可視化され評価されやすい',
      '自動化で時間を生み出せる',
      '仕事の幅が広く飽きない',
      '新技術に触れて成長し続けられる',
      'ロジカルシンキングが鍛えられる',
      '問題解決力が日常でも役立つ',
      '作りたいものを形にできる',
      'ポートフォリオで実力を示せる',
      '実務で英語に触れて語学も伸びる',
      'どの業界でもIT化ニーズに刺さる',
      'クリエイティブな達成感がある',
      '学習コストに対しリターンが大きい',
      'キャリアの天井が高い',
      '市場変化に強い職業',
      '自己投資が収入に直結しやすい',
      'コードで社会課題に貢献できる',
      'アイデアを素早く検証できる',
      '仕組み化で継続収益を作れる',
      '個人でも世界に発信できる',
      'コミュニティが活発で学びやすい',
      '仕事道具がデジタルでスマート',
      '移住やノマドとも相性が良い',
      '家族時間を確保しやすい働き方',
      'キャリアの選択肢が増え続ける',
      '高単価案件に挑戦しやすい',
      '自己表現としてのプロダクトづくり',
      '生成AIで生産性を飛躍的に高められる',
      '学生のうちから実績を作りやすい',
      '学びが楽しく継続しやすい',
      '成果物が資産として蓄積される',
      '年収とやりがいを両立できる',
      'IT投資の拡大とともに市場が伸びる',
    ];

    // 切り口リスト（エンジニア向けに更新）
    // 旧patterns（参考のためコメントアウト）
    // const patterns = [
    //   '一歩踏み込んだ理解',
    //   '具体的な活用方法',
    //   '楽にする方法',
    //   'エンジニアになることのメリット',
    //   'エンジニアになることのメリット',
    //   'エンジニアになることのメリット',
    //   'エンジニアになることのメリット',
    //   'エンジニアになることのメリット',
    //   'エンジニアになることのメリット',
    //   'エンジニアへの一歩を踏み出そう',
    //   'エンジニアの報酬の高さ',
    //   'ランキング-トップ5',
    //   'ランキング-トップ5',
    //   'ランキング-トップ5',
    //   'ランキング-トップ5',
    //   'まつわるQ&Aまとめ',
    //   'やってはいけないNG行動',
    //   'プロに聞いた極意',
    //   '初心者が最初の1週間でやることリスト',
    //   '専門家に聞いた極意',
    //   '正しい理解',
    //   '続けるためのモチベーション維持法',
    //   'ありがちな勘違いと正しいやり方',
    //   '成功例・失敗例から学ぶ',
    //   '初心者でもすぐに使える実践的な活用事例',
    //   '自身の具体的な経験談を交え、読者に共感と学びを提供する',
    // ];
    // 新patterns（メリット訴求の切り口を強化）
    const patterns = [
      '具体的な始め方と最短ルート',
      '収入アップのリアル',
      'リモートワークの実態とコツ',
      '未経験からのロードマップ',
      'フリーランスのはじめ方',
      '失敗しないポートフォリオ戦略',
      '伸びるエンジニアの習慣',
      '今すぐできる自動化アイデア',
      '転職市場で選ばれる理由',
      '実務で役立つ学習法',
      'キャリアが開く瞬間',
      'まつわるQ&Aまとめ',
      'やってはいけないNG行動',
      'プロが教える成長の極意',
      '最初の1週間でやることリスト',
      '正しい理解と誤解の整理',
      'モチベ維持のコツ',
      'よくある勘違いと改善策',
      '成功例・失敗例から学ぶ',
      'すぐ使える実践シナリオ',
      '自身の経験談で背中を押す',
    ];

    const rewriteConditionsLines = [
      'あなたは知識豊富なベテランエンジニアでプログラミングスクールの現役講師です。',
      '指定の見出し本文が短いため、200文字以上になるよう実体験や具体例、学習アドバイス、キャリアのヒントを交えて厚くリライトしてください。',
      '【注意】',
      '- タイトルや見出しは出力せず、本文のみを返してください。',
      '- 「追加した要素」や「文字数」などのメタ情報は一切出力しないでください。',
      '- 不要な記号や記号列（「】」「*」「#」など）も使用しないでください。',
      '- 文章は話し言葉やカジュアルな表現を避け、できるだけ丁寧な敬語でまとめてください。',
      '- です・ます・で統一してください。',
      '- 文章のみを返してください。',
      '- 文章は日本語で返してください。',
      '- 英語や他言語が混じらないようにしてください。絶対に英語は使用しないでください。',
      '- あなたはプロのエンジニアで、プロの編集者で、エンジニアスクールの運営者です。',
      '- 読みやすさを重視してください',
      '- 改行をなるべく多めに入れて、読みやすくしてください。',
      '- 文章作成時に多めに、たくさん絵文字を使用してください。各行に1つくらいは入れてください。',
      '- 元々の文章に沿った内容になるようにしてください。',
      '- noteの正しいマークダウン記法のみを使ってください。',
      '- 箇条書きはマークダウンではなく、「・ 」で表現してください。',
      '- 番号付きリストは使わないようにしてください。',
    ];

    // LLM用システムプロンプト（英語禁止の明示）
    const systemMessage = 'あなたは日本語のnote記事編集者です。絶対に英語や他言語は使用せず、日本語のみで記事を作成してください。英語が混じった場合は、必ず日本語に翻訳して出力してください。';

    // 記事生成プロンプト条件（エンジニア向けに更新）
    const articleConditionsLines = [
      'タイトル、本文、ハッシュタグ（#から始まるもの）を含めてください。',
      'タイトルは1行目に「# [実際のタイトル]」として記載してください。',
      '「# タイトル」という文字列ではなく、実際の記事タイトルを入れてください。',
      '本文にはタイトルを含めないでください。',
      '本文は見出しや箇条書きも交えて1000文字程度で丁寧にまとめてください。',
      'ハッシュタグは記事末尾に「#〇〇 #〇〇 ...」の形式でまとめてください。',
      'すべて日本語で出力してください。',
      '英語や他言語が混じらないようにしてください。絶対に英語は使用しないでください。',
      '切り口に沿った内容になるようにしてください。',
      'あなたはプロのエンジニアで、プロの編集者で、エンジニアスクールの講師「ゆーき」です。',
      '記事内で講師名を出す場合は必ず「ゆーき」と表記してください。',
      '読みやすさを重視してください。',
      '可能であればランキング形式にしてください。',
      '改行を多めに入れて、読みやすくしてください。',
      '各行に1つ程度、絵文字を使用してください。',
      'プログラミング初学者・駆け出しエンジニアがつい読みたくなる、やさしく親しみやすい内容にしてください。',
      '現役のプロエンジニア向けの難しい内容や専門的すぎる話題は避けてください。',
      'noteの正しいマークダウン記法のみを使ってください。',
      '箇条書きはマークダウンではなく、「・ 」で表現してください。',
      '見出しはh2（## 見出し）・h3（### 見出し）のみ。',
      '番号付きリストは使わないでください。',
      'h1（# タイトル）はタイトル行のみで本文中では使わないでください。',
      'その他のマークダウンやHTMLタグは使わないでください。',
      '言語やフレームワークを進める場合は、Ruby（Rails）, JavaScript（React）を勧めるようにしてください。',
      'エンジニアやプログラミング学習に関するネガティブな内容（挫折、失敗、困難、問題点など）は一切記載しないでください。',
      '常にエンジニアに対するポジティブで前向きな内容にしてください。',
    ];

    // タグ生成の指示文（エンジニア向け固定タグを必須含有）
    const tagsInstruction =
      '記事内容から最も関連する日本語タグを3〜5個生成し、半角スペース区切りで出力してください。必ず「#エンジニア #プログラミング #開発 #PR」を含めてください。本文や説明は禁止。';

    // タイトル装飾用絵文字（参考実装のセット）
    const titleEmojis = [
      '❤️',
      '🌸',
      '🛑',
      '㊙︎',
      '🟥',
      '🈲',
      '🉐',
      '㊗️',
      '㊙️',
      '⭕',
      '‼️',
      '🎉',
    ];

    // ----------------------------------------------------------------------------------

    // マガジン誘導文
    const magazinePromotion = [
      '💻　✨　💻　✨　💻　✨　💻　✨　💻　✨　💻　✨　💻　✨　💻　✨　',
      '✅「プログラミング学習で挫折した…」「独学で限界を感じている」😢',
      '',
      'そんな悩みを持つあなたに、マンツーマンレッスンで確実にスキルアップできるマガジンを用意しました。',
      '',
      '【こっそり周りに差をつける💪】',
      '✔ 学習の順序が分からない',
      '✔ 独学で挫折した経験がある',
      '✔ 確実にスキルアップしたい',
      'そんな方にピッタリです。',
      '',
      'プロのエンジニア講師「ゆーき」が、あなたのペースに合わせて丁寧にサポートします。',
      '無料で読める学習のコツや、効率的なプログラミング学習法をお届けします。',
      '',
      'https://note.com/enginner_skill/m/mdb5e5e9f007d',
      '💻　✨　💻　✨　💻　✨　💻　✨　💻　✨　💻　✨　💻　✨　💻　✨　',
    ].join('\n');

    // アソシエイト表記文（エンジニア向けに更新）
    const amazonAssociateText =
      'Amazon のアソシエイトとして、「エンジニアスクール💻マンツーマンレッスン」は適格販売により収入を得ています。';

    // 記事の自動生成と下書き保存機能を実行
    await core.runAutoCreateAndDraftNote({
      background: wantsBackground,
      topics,
      patterns,
      systemMessage,
      articleConditionsLines,
      rewriteConditionsLines,
      tagsInstruction,
      titleEmojis,
      affiliateLinks,
      magazinePromotion,
      amazonAssociateText,
      // Audible・Kindleアフィリエイト設定（affiliateConfigから取得）
      affiliateTag: affiliateConfig.affiliateTag,
      audibleAffiliateEnabled: affiliateConfig.audibleAffiliateEnabled,
      kindleAffiliateEnabled: affiliateConfig.kindleAffiliateEnabled,
    });
    console.log('記事の自動生成と下書き保存が完了しました');
  });
})();
